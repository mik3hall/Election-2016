---
title: "Election 2016"
author: "Mike Hall"
date: "2/24/2018"
output:
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

A recent news program discussion of gerrymandering got me interested in number
crunching election data. There was a recent metric developed for legally establishing gerrymandering - [Partisan Gerrymandering and the Efficiency Gap](https://chicagounbound.uchicago.edu/cgi/viewcontent.cgi?referer=https://duckduckgo.com/&httpsredir=1&article=1946&context=public_law_and_legal_theory). 

I may consider if that has any bearing here but it doesn't seem immediately likely. My main interest will be the 2016 presidential election. Obviously in a presidential election gerrymandering isn't a concern. Getting data on these things can be difficult. But through a variety of sources I was able to get presidential election results by county for '04 to '16. Having it at the county level might give large enough sample sizes so some statistics methods could make sense.

```{r load}
data04 <- read.csv("county04.csv")
data08 <- read.csv("county08.csv")
data12 <- read.csv("county12.csv")
data16 <- read.csv("county16.csv")
```

Different sources seemed to slightly differ from other sources. But I believe the
results are correct enough for my purposes. For example...

```{r popular}
diff16 <- data16$dem.Count16 - data16$gop.Count16
sum(diff16)
```

Shows a democratic popular vote win of a million plus. [This page](https://en.wikipedia.org/wiki/United_States_presidential_elections_in_which_the_winner_lost_the_popular_vote#2016:_Donald_Trump) indicates that this should actually be 2,868,691. Out of 62,984,825 total votes I consider getting the correct result and this close as accurate enough.

There has been considerable discussion of how Trump found his way through to a 
Electoral college win despite this. Talk of Russian hacker interference and Wikileaks, also the Comey letter. Mainly, the conventional wisdom seems to be that the Democrats simply didn't reach the voters that they had to have. What I am mainly would like to consider is what the numbers might tell us about how this result was reached.

## Simple probability and counting - Party flipping by county

To begin with I am going to ignore actual vote total and just count up counties flipping and compare 2016 to earlier years concerning the probabilities of counties flipping. I represent a county flipping parties as (1 = Rep->Dem,0 = no change, or -1 = Dem->Rep). See the flips.csv dataset.  

```{r load flips, echo=FALSE}
flips <- read.csv("flips.csv")
by.state <- read.csv("state_probs.csv")
```

From election to election...
```{r election flips, echo=FALSE}
cat("2008")
table(flips$f0408)
cat("2012")
table(flips$f0812)
cat("2016")
table(flips$f1216)
```
It can be seen that there was a big shift in counties from Republican to Democrat in the 2008 election. This might of been 'making a statement' votes against a unpopular Bush presidency or it could of been the historic Obama candidacy. For whatever reason it was a major shift. 

This trend did not continue. Already in the 2012 election many more counties were reverting to Republican. Was this what is known in statistics as [Reversion to the mean?](https://en.wikipedia.org/wiki/Regression_toward_the_mean). Normally Republican tending counties voting more as usual? Or something else? Maybe a reversal that the Democrats should of already been aware of for the 2016 election? 

In the 2016 election counties continued flipping to Republican, only even more so. The last two elections more than reversed the Democrat county gains from 2008.

The overall probability that a random county might flip...
```{r random county, echo=FALSE}
(sum(flips$f0408 != 0) + sum(flips$f0812 != 0) + sum(flips$f1216 != 0)) / (nrow(flips)*3)
```

So there has been about a 9% chance over the last 3 presidential elections that a random county will flip from it's party vote for the prior election. This is actually higher than I thought it would be.

That is the percentage across the country with all things being equal. But they are not equal, some states are party base states while others are considered swing states. The probability a county might flip from state to state can be considerably different.

The probabilites of a county flipping by state... 
```{r by state, echo=FALSE}
order.probs <- order(by.state$sdata,decreasing=TRUE)
by.order <- by.state[order.probs,]
cat("Top 10 highest probability party flipping states")
head(by.order,10)
cat("Top 10 lowest probability party flipping states")
tail(by.order,10)
```
Somewhat interestingly, in checking the Top 10 states Clinton seems to have taken 7 of them for a significant 80 to 32 point lead in electoral college votes. Maybe a little interesting is that five states had no counties flip at all in the last three elections. Again, states can be considerably different.

Two states commonly talked about as important swing states are Florida and Ohio. Their probabilities for county flipping are...

```{r swing states, echo=FALSE}
cat('Florida')
by.state[by.state$states=="FL",]
cat('Ohio')
by.state[by.state$states=="OH",]
```

Neither is very high, Florida is actually fairly low with less than 5%. But both states flipped Republican from the 2012 election for a total of 47 electoral college votes. 

Although the election to election numbers seemed significant for showing trends for my purposes it might make more sense to consider the states that flipped in 2016 and then drill down into their counties to see why. Or, the county flipping analysis is just too simplistic and actual vote tallies and possible unusual turnout need to be taken into account. 

All things being equal doesn't apply to states and it doesn't to counties either. The Demcrat base counties tend to be urban and more highly populated than Republican. The number of Republican counties greatly exceeds the number of Democrat ones. 

Over the last four elections the percentage of counties voting Republican was...
```{r rep counties, echo=FALSE}
(sum(data04$gop.Count04 > data04$dem.Count04)+sum(data08$gop.Count08 > data08$dem.Count08)+sum(data12$gop.Count12 > data12$dem.Count12)+sum(data16$gop.Count16 > data16$dem.Count16))/(nrow(data04)*4)
```

With the above mentioned trend in county flipping after the 2016 election this was...
```{r 2016 rep counties, echo=FALSE}
(sum(data16$gop.Count16 > data16$dem.Count16))/nrow(data16)
```

And Clinton won on popular vote. Clearly she had wasted votes, this is what the gerrymandering "efficiency gap" is based on. Maybe it is a measure that can apply without gerrymandering. One consequence of this would seem to be that when a Democrat county flips it means more votes lost, on average, than when a Republican county flips. All things and all counties not being equal.

******

## 2016

Taking things to the state level since this is where the electoral college votes are. We might ask at this level, what states flipped between 2012 and 2016?

```{r get flipped states, echo=FALSE}
state.flips <- function(s1,s2) {
	flips <- c()
	for (i in 1:length(s1)) {
		if (s1[i] >= 0 && s2[i] >= 0) { flips <- c(flips,0) }
		else if (s1[i] < 0 && s2[i] < 0) { flips <- c(flips,0) }
		else if (s1[i] > 0 && s2[i] < 0) { flips <- c(flips,-1) }
		else if (s1[i] < 0 && s2[i] > 0) { flips <- c(flips,1) }
		else { flips <- c(flips,0) }
	}
	return(flips)
}

ev <- read.csv("electoral.csv")
ev[with(ev,order("State")),]
ev$diff.12 <- ev$dem12-ev$rep12
ev$diff.16 <- ev$dem16-ev$rep16
ev$flips <- state.flips(ev$diff.12,ev$diff.16)
print(table(ev$flips))
```

You can see that six states flipped from Democrat to Republican, the rest all stayed the same, with no Republican states flipping to Democrat ones.

What were the six states that flipped Republican?

```{r flipped republican, echo=FALSE}
flipped <- ev[ev$flips==-1,c("State","EV","diff.12","diff.16")]
print(flipped)
```

These are the only six states. They decided the election. All other states had the same result as in 2012. 

How many electoral votes did these states account for?

```{r flipped electoral, echo=FALSE}
sum(flipped$EV)
```

Romney had 206 in in 2012, adding in the 99 gives Trump a definite win. It probably could of taken a couple less than the six for the win, if you want to figure that out. Then you could possibly say the remaining were actually the only states that had mattered.

However, for what follows I will consider each of the six that flipped.

## Florida

The Republican margin of victory in the state was...
```{r florida win, echo=FALSE}
margin <- abs(ev[ev$State=="FL","diff.16"])
per <- margin/(ev[ev$State=="FL","dem16"]+ev[ev$State=="FL","rep16"])
print(paste(margin," (",round(per*100,2),"%)",sep=""))
```

```{r fl voter turnout, echo=FALSE}
cat("Florida Voter Turnout")
dem.04 <- sum(data04[data04$State=="FL","dem.Count04"])
gop.04 <- sum(data04[data04$State=="FL","gop.Count04"])
dem.08 <- sum(data08[data08$State=="FL","dem.Count08"])
gop.08 <- sum(data08[data08$State=="FL","gop.Count08"])
dem.12 <- sum(data12[data12$State=="FL","dem.Count12"])
gop.12 <- sum(data12[data12$State=="FL","gop.Count12"])
dem.16 <- sum(data16[data16$State=="FL","dem.Count16"])
gop.16 <- sum(data16[data16$State=="FL","gop.Count16"])
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts
```

I had originally thought there might be some way to differentiate between new voters turning out and voters switching parties in their voting. Here the number of Democrat voters increases as well as the Republican ones. It is difficult to say that they had voters changing parties. But there really is no way to know. 

Turnout across the election years will still be provided as an indication of voter motivation in the election.

For seeing what happened in Florida I will first go back to the county level and see what the flipped counties look like just for this state.

```{r flipped florida counties, echo=FALSE}
table(flips[flips$State=="FL","f1216"])
```

There are only four counties that flipped to Republican this election.

```{r flipped florida counties data, echo=FALSE}
fl <- flips[which(flips$State=="FL"),]
flipped.fl <- fl[which(fl$f1216==-1),c("County")]
flipped.fl <- as.character(flipped.fl)
data12.fl <- data12[data12$State=="FL",]
counties12 <- data12.fl[data12.fl$County %in% flipped.fl,]
diff12.fl <- counties12$dem.Count12 - counties12$gop.Count12
data16.fl <- data16[data16$State=="FL",]
counties16 <- data16.fl[data16.fl$County %in% flipped.fl,]
diff16.fl <- counties16$dem.Count16 - counties16$gop.Count16
data.fl <- data.frame(cbind(flipped.fl,diff12.fl,diff16.fl))
data.fl
```

The vote swings for the four flipped counties account for only a portion of the Republican margin of victory. The rest has to be other counties where the Republican vote outperformed or the Democrat vote underperformed. It may not be statewide but it does have to involve more than the flipped counties.

Consider the average party results for the 2012 and 2016 elections for statewide.

```{r statewide means, echo=FALSE}
mean.d12 <- mean(counties12$dem.Count12)
mean.r12 <- mean(counties12$gop.Count12)
mean.d16 <- mean(counties16$dem.Count16)
mean.r16 <- mean(counties16$gop.Count16)

state.means <- data.frame(cbind("FL",mean.d12,mean.r12,mean.d16,mean.r16))
state.means
```

So statewide the Democrat vote tallies are on average down while the Republican tallies are up on average. Is this really statewide or can some smaller subset of counties be identified that swung the election?

From the averages it seems that Republican gains were more a factor than Democrat losses in voter turnout. But I will consder both, which were the biggest county gainers and which had the largest losses?

Looking at the Top 10 gains for each party...

```{r biggest gains, echo=FALSE}
names <- as.character(data12[data12$State=="FL","County"])
diff.d16 <- data16[data16$State=="FL","dem.Count16"] - data12[data12$State=="FL","dem.Count12"]
diff.d16 <- as.numeric(diff.d16)
diff.d16.df <- data.frame(names)
diff.d16.df$diff.d16 <- diff.d16
diff.d16.df <- diff.d16.df[order(diff.d16.df[,2],decreasing=TRUE),]
cat("Top 10 Democrat county gains")
head(diff.d16.df,10)
diff.r16 <- data16[data16$State=="FL","gop.Count16"]-data12[data12$State=="FL","gop.Count12"]
diff.r16 <- as.numeric(diff.r16)
diff.r16.df <- data.frame(names)
diff.r16.df$diff.r16 <- diff.r16
diff.r16.df <- diff.r16.df[order(diff.r16.df[,2],decreasing=TRUE),]
cat("Top 10 Republican county gains")
head(diff.r16.df,10)
```

You can see that for the first three counties the Democrats did very well. This would be in their more urban, highly populated base. After that the Republican gains start being greater, this begins with Pinellas which you might remember was one of the counties that actually flipped between 2012 and 2016. 

In table form...

```{r fl table gains, echo=FALSE}
cat("Democrat gains greater than Republican gains")
print(table(diff.r16.df$diff.r16 > diff.d16.df$diff.d16))
```

Counties where the Republicans out-gained the Democrats number 64 to 3. 

If the gains are totaled up...

```{r biggest changers, echo=FALSE}

cat("Total Democrat gains between 2012 and 2016")
sum(diff.d16)
cat("Total Republican gains between 2012 and 2016")
sum(diff.r16)
```

Both parties gained votes in 2016. You can't really even say that the Democrats underperformed. It's just that the Replubicans very considerably outperformed across the state. There is no key subset of counties for the Democrats to address. They need statewide improvement or less Republican improvement. 

## Iowa

The Republican margin of victory in the state was...
```{r iowa win, echo=FALSE}
margin <- abs(ev[ev$State=="IA","diff.16"])
per <- margin/(ev[ev$State=="IA","dem16"]+ev[ev$State=="IA","rep16"])
print(paste(margin," (",round(per*100,2),"%)",sep=""))
```

```{r ia voter turnout, echo=FALSE}
cat("Iowa Voter Turnout")
dem.04 <- sum(data04[data04$State=="IA","dem.Count04"])
gop.04 <- sum(data04[data04$State=="IA","gop.Count04"])
dem.08 <- sum(data08[data08$State=="IA","dem.Count08"])
gop.08 <- sum(data08[data08$State=="IA","gop.Count08"])
dem.12 <- sum(data12[data12$State=="IA","dem.Count12"])
gop.12 <- sum(data12[data12$State=="IA","gop.Count12"])
dem.16 <- sum(data16[data16$State=="IA","dem.Count16"])
gop.16 <- sum(data16[data16$State=="IA","gop.Count16"])
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts
```

Flipped counties...

```{r flipped iowa counties, echo=FALSE}
table(flips[flips$State=="IA","f1216"])
```

Many counties actually flipped here, almost half.  

```{r flipped iowa counties data, echo=FALSE}
ia <- flips[which(flips$State=="IA"),]
flipped.ia <- ia[which(ia$f1216==-1),c("County")]
flipped.ia <- as.character(flipped.ia)
data12.ia <- data12[data12$State=="IA",]
counties12 <- data12.ia[data12.ia$County %in% flipped.ia,]
diff12.ia <- counties12$dem.Count12 - counties12$gop.Count12
data16.ia <- data16[data16$State=="IA",]
counties16 <- data16.ia[data16.ia$County %in% flipped.ia,]
diff16.ia <- counties16$dem.Count16 - counties16$gop.Count16
data.ia <- data.frame(cbind(flipped.ia,diff12.ia,diff16.ia))
data.ia
```

I don't know if I have the data to indicate whether this result is more unusual or that the state favored the Democrat Barack Obama as it did. But based only on the data I have, while not having the most electoral votes, it is clear that for this election the Democrat candidate underperformed badly.

## Michigan

The Republican margin of victory in the state was...
```{r michigan win, echo=FALSE}
margin <- abs(ev[ev$State=="MI","diff.16"])
per <- margin/(ev[ev$State=="MI","dem16"]+ev[ev$State=="MI","rep16"])
print(paste(margin," (",round(per*100,2),"%)",sep=""))
```

Very close.

```{r mi voter turnout, echo=FALSE}
cat("Michigan Voter Turnout")
dem.04 <- sum(data04[data04$State=="MI","dem.Count04"])
gop.04 <- sum(data04[data04$State=="MI","gop.Count04"])
dem.08 <- sum(data08[data08$State=="MI","dem.Count08"])
gop.08 <- sum(data08[data08$State=="MI","gop.Count08"])
dem.12 <- sum(data12[data12$State=="MI","dem.Count12"])
gop.12 <- sum(data12[data12$State=="MI","gop.Count12"])
dem.16 <- sum(data16[data16$State=="MI","dem.Count16"])
gop.16 <- sum(data16[data16$State=="MI","gop.Count16"])
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts
```

Flipped counties...

```{r flipped michigan counties, echo=FALSE}
table(flips[flips$State=="MI","f1216"])
```

And which ones...

```{r flipped michigan counties data, echo=FALSE}
mi <- flips[which(flips$State=="MI"),]
flipped.mi <- mi[which(mi$f1216==-1),c("County")]
flipped.mi <- as.character(flipped.mi)
data12.mi <- data12[data12$State=="MI",]
counties12 <- data12.mi[data12.mi$County %in% flipped.mi,]
diff12.mi <- counties12$dem.Count12 - counties12$gop.Count12
data16.mi <- data16[data16$State=="MI",]
counties16 <- data16.mi[data16.mi$County %in% flipped.mi,]
diff16.mi <- counties16$dem.Count16 - counties16$gop.Count16
data.mi <- data.frame(cbind(flipped.mi,diff12.mi,diff16.mi))
data.mi
```

Leaning Republican.

The overall averages...

```{r mi statewide means, echo=FALSE}
mean.d12 <- sprintf("%.2f",mean(counties12$dem.Count12))
mean.r12 <- sprintf("%.2f",mean(counties12$gop.Count12))
mean.d16 <- sprintf("%.2f",mean(counties16$dem.Count16))
mean.r16 <- sprintf("%.2f",mean(counties16$gop.Count16))

state.means <- data.frame(cbind("MI",mean.d12,mean.r12,mean.d16,mean.r16))
state.means
```

More of a Democrat loss than Florida but not as much in Republican gains. But both again favor the Republicans.

The Top 10 gains for each party...

```{r MI biggest gains, echo=FALSE}
names <- as.character(data12[data12$State=="MI","County"])
diff.d16 <- data16[data16$State=="MI","dem.Count16"] - data12[data12$State=="MI","dem.Count12"]
diff.d16 <- as.numeric(diff.d16)
diff.d16.df <- data.frame(names)
diff.d16.df$diff.d16 <- diff.d16
diff.d16.df <- diff.d16.df[order(diff.d16.df[,2],decreasing=TRUE),]
cat("Top 10 Democrat county gains")
head(diff.d16.df,10)
diff.r16 <- data16[data16$State=="MI","gop.Count16"]-data12[data12$State=="MI","gop.Count12"]
diff.r16 <- as.numeric(diff.r16)
diff.r16.df <- data.frame(names)
diff.r16.df$diff.r16 <- diff.r16
diff.r16.df <- diff.r16.df[order(diff.r16.df[,2],decreasing=TRUE),]
cat("Top 10 Republican county gains")
head(diff.r16.df,10)
```

The Democrats managed gains in only six counties. They didn't do as well as in Florida in hanging onto their base, even losing ground in Macomb county which appears to be part of metro Detroit. A more high population Democrat type county. 

The loss seems statewide again. Although more due to the Democrat's not doing as well as they might of rather than large scale Republican outperforming. This state could easily of gone Democrat. Macomb county alone would of given it to them if they had hung onto it.

## Ohio

The Republican margin of victory in the state was...
```{r ohio win, echo=FALSE}
margin <- abs(ev[ev$State=="OH","diff.16"])
per <- margin/(ev[ev$State=="OH","dem16"]+ev[ev$State=="OH","rep16"])
print(paste(margin," (",round(per*100,2),"%)",sep=""))
```

A big Republican win.

```{r oh voter turnout, echo=FALSE}
cat("Ohio Voter Turnout")
dem.04 <- sum(data04[data04$State=="OH","dem.Count04"])
gop.04 <- sum(data04[data04$State=="OH","gop.Count04"])
dem.08 <- sum(data08[data08$State=="OH","dem.Count08"])
gop.08 <- sum(data08[data08$State=="OH","gop.Count08"])
dem.12 <- sum(data12[data12$State=="OH","dem.Count12"])
gop.12 <- sum(data12[data12$State=="OH","gop.Count12"])
dem.16 <- sum(data16[data16$State=="OH","dem.Count16"])
gop.16 <- sum(data16[data16$State=="OH","gop.Count16"])
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts
```

Flipped counties...

```{r flipped ohio counties, echo=FALSE}
table(flips[flips$State=="OH","f1216"])
```

Which ones...

```{r flipped ohio counties data, echo=FALSE}
oh <- flips[which(flips$State=="OH"),]
flipped.oh <- oh[which(oh$f1216==-1),c("County")]
flipped.oh <- as.character(flipped.oh)
data12.oh <- data12[data12$State=="OH",]
counties12 <- data12.oh[data12.oh$County %in% flipped.oh,]
diff12.oh <- counties12$dem.Count12 - counties12$gop.Count12
data16.oh <- data16[data16$State=="OH",]
counties16 <- data16.oh[data16.oh$County %in% flipped.oh,]
diff16.oh <- counties16$dem.Count16 - counties16$gop.Count16
data.oh <- data.frame(cbind(flipped.oh,diff12.oh,diff16.oh))
data.oh
```

The overall averages...

```{r oh statewide means, echo=FALSE}
mean.d12 <- sprintf("%.2f",mean(counties12$dem.Count12))
mean.r12 <- sprintf("%.2f",mean(counties12$gop.Count12))
mean.d16 <- sprintf("%.2f",mean(counties16$dem.Count16))
mean.r16 <- sprintf("%.2f",mean(counties16$gop.Count16))

state.means <- data.frame(cbind("MI",mean.d12,mean.r12,mean.d16,mean.r16))
state.means
```

A large Democrat decline and moderate Republican gains.

The Top 10 gains for each party...

```{r OH biggest gains, echo=FALSE}
names <- as.character(data12[data12$State=="OH","County"])
diff.d16 <- data16[data16$State=="OH","dem.Count16"] - data12[data12$State=="OH","dem.Count12"]
diff.d16 <- as.numeric(diff.d16)
diff.d16.df <- data.frame(names)
diff.d16.df$diff.d16 <- diff.d16
diff.d16.df <- diff.d16.df[order(diff.d16.df[,2],decreasing=TRUE),]
cat("Top 10 Democrat county gains")
head(diff.d16.df,10)
diff.r16 <- data16[data16$State=="OH","gop.Count16"]-data12[data12$State=="OH","gop.Count12"]
diff.r16 <- as.numeric(diff.r16)
diff.r16.df <- data.frame(names)
diff.r16.df$diff.r16 <- diff.r16
diff.r16.df <- diff.r16.df[order(diff.r16.df[,2],decreasing=TRUE),]
cat("Top 10 Republican county gains")
head(diff.r16.df,10)
```

It was a little difficult for me to understand how the numbers I'm getting accounted for the large Republican margin of victory. But with almost every county statewide shifting more Republican, and each Republican gain representing a Democrat loss, it seems that it does. 

## Pennsylvania

The Republican margin of victory in the state was...
```{r penn win, echo=FALSE}
margin <- abs(ev[ev$State=="PA","diff.16"])
per <- margin/(ev[ev$State=="PA","dem16"]+ev[ev$State=="PA","rep16"])
print(paste(margin," (",round(per*100,2),"%)",sep=""))
```

```{r pa voter turnout, echo=FALSE}
cat("Pennsylvania Voter Turnout")
dem.04 <- sum(data04[data04$State=="PA","dem.Count04"])
gop.04 <- sum(data04[data04$State=="PA","gop.Count04"])
dem.08 <- sum(data08[data08$State=="PA","dem.Count08"])
gop.08 <- sum(data08[data08$State=="PA","gop.Count08"])
dem.12 <- sum(data12[data12$State=="PA","dem.Count12"])
gop.12 <- sum(data12[data12$State=="PA","gop.Count12"])
dem.16 <- sum(data16[data16$State=="PA","dem.Count16"])
gop.16 <- sum(data16[data16$State=="PA","gop.Count16"])
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts
```

Flipped counties...

```{r flipped penn counties, echo=FALSE}
table(flips[flips$State=="PA","f1216"])
```

A couple actually flipped to Democrat.

Which ones flipped...

```{r flipped penn counties data, echo=FALSE}
pa <- flips[which(flips$State=="PA"),]
flipped.pa <- pa[which(pa$f1216==-1 | pa$f1216==1),c("County")]
flipped.pa <- as.character(flipped.pa)
data12.pa <- data12[data12$State=="PA",]
counties12 <- data12.pa[data12.pa$County %in% flipped.pa,]
diff12.pa <- counties12$dem.Count12 - counties12$gop.Count12
data16.pa <- data16[data16$State=="PA",]
counties16 <- data16.pa[data16.pa$County %in% flipped.pa,]
diff16.pa <- counties16$dem.Count16 - counties16$gop.Count16
data.pa <- data.frame(cbind(flipped.pa,diff12.pa,diff16.pa))
data.pa
```

The overall averages...

```{r pa statewide means, echo=FALSE}
mean.d12 <- sprintf("%.2f",mean(counties12$dem.Count12))
mean.r12 <- sprintf("%.2f",mean(counties12$gop.Count12))
mean.d16 <- sprintf("%.2f",mean(counties16$dem.Count16))
mean.r16 <- sprintf("%.2f",mean(counties16$gop.Count16))

state.means <- data.frame(cbind("PA",mean.d12,mean.r12,mean.d16,mean.r16))
state.means
```

The Democrats lost hardly anything at all but the Republicans posted decent gains.

The Top 10 gains for each party...

```{r PA biggest gains, echo=FALSE}
names <- as.character(data12[data12$State=="PA","County"])
diff.d16 <- data16[data16$State=="PA","dem.Count16"] - data12[data12$State=="PA","dem.Count12"]
diff.d16 <- as.numeric(diff.d16)
diff.d16.df <- data.frame(names)
diff.d16.df$diff.d16 <- diff.d16
diff.d16.df <- diff.d16.df[order(diff.d16.df[,2],decreasing=TRUE),]
cat("Top 10 Democrat county gains")
head(diff.d16.df,10)
diff.r16 <- data16[data16$State=="PA","gop.Count16"]-data12[data12$State=="PA","gop.Count12"]
diff.r16 <- as.numeric(diff.r16)
diff.r16.df <- data.frame(names)
diff.r16.df$diff.r16 <- diff.r16
diff.r16.df <- diff.r16.df[order(diff.r16.df[,2],decreasing=TRUE),]
cat("Top 10 Republican county gains")
head(diff.r16.df,10)
```

The Democrats did well in the top spots. These appear from Wikipedia to be somewhat typical base counties for them, highly populated and in the case of Chester high income. But getting past the first three places the Republican gains again take over in being better than the Democrat ones. Actually, even Philidelphia county itself shows superior Republican gains so Democrats were not entirely successful in preserving their base.

## Wisconsin

The Republican margin of victory in the state was...
```{r wisc win, echo=FALSE}
margin <- abs(ev[ev$State=="WI","diff.16"])
per <- margin/(ev[ev$State=="WI","dem16"]+ev[ev$State=="WI","rep16"])
print(paste(margin," (",round(per*100,2),"%)",sep=""))
```

Again, pretty close.

```{r wi voter turnout, echo=FALSE}
cat("Wisconsin Voter Turnout")
dem.04 <- sum(data04[data04$State=="WI","dem.Count04"])
gop.04 <- sum(data04[data04$State=="WI","gop.Count04"])
dem.08 <- sum(data08[data08$State=="WI","dem.Count08"])
gop.08 <- sum(data08[data08$State=="WI","gop.Count08"])
dem.12 <- sum(data12[data12$State=="WI","dem.Count12"])
gop.12 <- sum(data12[data12$State=="WI","gop.Count12"])
dem.16 <- sum(data16[data16$State=="WI","dem.Count16"])
gop.16 <- sum(data16[data16$State=="WI","gop.Count16"])
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts
```

Flipped counties...

```{r flipped wisc counties, echo=FALSE}
table(flips[flips$State=="WI","f1216"])
```

Which ones flipped...

```{r flipped wisc counties data, echo=FALSE}
wi <- flips[which(flips$State=="WI"),]
flipped.wi <- wi[which(wi$f1216==-1),c("County")]
flipped.wi <- as.character(flipped.wi)
data12.wi <- data12[data12$State=="WI",]
counties12 <- data12.wi[data12.wi$County %in% flipped.wi,]
diff12.wi <- counties12$dem.Count12 - counties12$gop.Count12
data16.wi <- data16[data16$State=="WI",]
counties16 <- data16.wi[data16.wi$County %in% flipped.wi,]
diff16.wi <- counties16$dem.Count16 - counties16$gop.Count16
data.wi <- data.frame(cbind(flipped.wi,diff12.wi,diff16.wi))
data.wi
```

The overall averages...

```{r wisc statewide means, echo=FALSE}
mean.d12 <- sprintf("%.2f",mean(counties12$dem.Count12))
mean.r12 <- sprintf("%.2f",mean(counties12$gop.Count12))
mean.d16 <- sprintf("%.2f",mean(counties16$dem.Count16))
mean.r16 <- sprintf("%.2f",mean(counties16$gop.Count16))

state.means <- data.frame(cbind("WI",mean.d12,mean.r12,mean.d16,mean.r16))
state.means
```

Fairly small both ways, but Democrat losses and Republican gains.

The Top 10 gains for each party...

```{r WI biggest gains, echo=FALSE}
names <- as.character(data12[data12$State=="WI","County"])
diff.d16 <- data16[data16$State=="WI","dem.Count16"] - data12[data12$State=="WI","dem.Count12"]
diff.d16 <- as.numeric(diff.d16)
diff.d16.df <- data.frame(names)
diff.d16.df$diff.d16 <- diff.d16
diff.d16.df <- diff.d16.df[order(diff.d16.df[,2],decreasing=TRUE),]
cat("Top 10 Democrat county gains")
head(diff.d16.df,10)
diff.r16 <- data16[data16$State=="WI","gop.Count16"]-data12[data12$State=="WI","gop.Count12"]
diff.r16 <- as.numeric(diff.r16)
diff.r16.df <- data.frame(names)
diff.r16.df$diff.r16 <- diff.r16
diff.r16.df <- diff.r16.df[order(diff.r16.df[,2],decreasing=TRUE),]
cat("Top 10 Republican county gains")
head(diff.r16.df,10)
```

The familiar pattern of very few Democrat gains but consistent Republican ones. It wasn't a big margin of victory but no county stands out here as one that might of swung the state.

******

## Voter Turnout

Overall voter turnout.

```{r overall voter turnout, echo=FALSE}
cat("Overall Voter Turnout")
dem.04 <- sum(data04$dem.Count04)
gop.04 <- sum(data04$gop.Count04)
dem.08 <- sum(data08$dem.Count08)
gop.08 <- sum(data08$gop.Count08)
dem.12 <- sum(data12$dem.Count12)
gop.12 <- sum(data12$gop.Count12)
dem.16 <- sum(data16$dem.Count16)
gop.16 <- sum(data16$gop.Count16)
turnouts <- data.frame(cbind(c(dem.04,gop.04,dem.04+gop.04),c(dem.08,gop.08,dem.08+gop.08),c(dem.12,gop.12,dem.12+gop.12),c(dem.16,gop.16,dem.16+gop.16)))
names(turnouts) <- c("2004","2008","2012","2016")
row.names(turnouts) <- c("Dem","Gop","Tot")
turnouts

```

2016 was the second best of the four elections for both parties. Democrats better than Republican, again they had the popular vote edge.

## Swing States

Swing states are still of interest to me. Again, Florida and Ohio are frequently discussed as swing states and both are included above. The six critical states for 2016, in hindsight, compared to the 2012 election. But how well can you tell for 2020 who the critical battleground states will be? 

It seemed to me that are some similarites here to finance. In finance risk is measured as volatility. How extremely do prices, or whatever, swing up and down? I did some checking for anything related to elections and volatility. I came across the [Pedersen Index](https://en.wikipedia.org/wiki/Pedersen_index). But this mainly seems concerned with volatility between multiple parties in European elections. Not regional volatility in a two party system. Not useful for my purposes.

Somewhat interesting again is efficiency gap for gerrymandering almost seems to relate. Looking at this [Washington Post article](https://www.washingtonpost.com/graphics/2017/politics/courts-law/gerrymander/), specifically towards the bottom, the graphic where it says "Some swing states have low scores". You will notice that four of our six states of interest are in the bottom 10 and Pennsylvania and Iowa aren't that much higher.

After some thought it seemed to me that what I am interested in is the probability that a state will swing. With 'P' indicating probability that seemed like it should be...

P(swing) = P(moves right way)*P(moves enough to swing)

With...

P(moves the right way) = # of times voted for that party/times voted

P(moves enough) = # of times moved enough/times moved

There again seems to be a question of how is sample size worked to give meaningful statistics. At the state or individual county level there might not be enough data. Possibly it can be summed across counties somehow for the state? But then don't number of votes have to also be accounted for, something like [Effect size](https://en.wikipedia.org/wiki/Effect_size). How much does each county contribute to the possibility that the state flips?

## Competitiveness

To begin with I will consider something a little simpler, party margin of victory as a percentage as shown above for the six states. This could relate to the probabilities above as one measure of the distance that needs to be moved for a state to flip. It can be seen standalone as a measure of how competitive the state is. The smaller the percentage, the more it is competitive. Possibly, a rough metric of how likely it is a swing state itself.

```{r competitiveness, echo=FALSE}
margins <- ev[,"diff.16"]
pers <- sprintf("%.4f",margins/(ev[,"dem16"]+ev[,"rep16"]))
comp <- data.frame(cbind(as.character(ev$State),pers))
names(comp) <- c("State","Percentage")
sorted <- order(comp$Percentage)
comp <- comp[sorted,]
comp$Percentage <- as.numeric(as.character(comp$Percentage))*100
head(comp,10)
```

Four of our six critical states head the list. The other two make the Top 10 list. Not too bad a metric itself, and very simple. All negative meaning Republican.