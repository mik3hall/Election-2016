---
title: "Gerrymandering"
author: "Mike Hall"
date: "3/3/2018"
output:
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Libraries, message=FALSE, warning=FALSE, echo=FALSE}
library(dplyr)
```

## Gerrymandering

States have requirements for their political districts that they must maintain. These include having equal populations and the districts should address VRA, the Voting Rights Act, issues to ensure fairness to minorities. To accomplish this the states must <mark>redistrict</mark> shortly after a census takes place. It has become more and more of a concern that states are trying to rig this process to gain more elected representatives than they should fairly have. Arranging districts for this purpose is called <mark>Gerrymandering</mark>, it is illegal. 

However, courts have maintained that they have no clear criteria to determine if Gerrymandering has actually been done. One such criteria that has been proposed is the <mark>Efficiency Gap</mark>, which will be considered here. One court case in particular was of interest to me. Gill v. Whitford, out of my home state of Wisconsin, prominently using the Efficiency Gap metric, and it was the case that has the Supreme Court itself reconsidering Gerrymandering.    

```{r load, echo=FALSE}
# 2002-2010 WI Election Data with 2011 Wards
w0210 <- read.csv("20022010_WI_Election_Data_with_2011_Wards.csv")
# 2012-2020 WI Election Data with 2011 Wards 
w11 <- read.csv("20122020_WI_Election_Data_with_2011_Wards.csv")
w11 <- w11[,c("OBJECTID_1","OBJECTID","GEOID10","NAME","ASM","CNTY_NAME","PERSONS18","WSADEM12","WSADEM14","WSADEM16","WSADEM212","WSAREP12","WSAREP14","WSAREP16","WSAREP212","WSAREP214")]
# 2012-2020 WI Election Data with 2017 Wards
w17 <- read.csv("Wards2017_ED12toED16.csv")
# For imputation
a0210 <- w0210 %>% group_by(ASM) %>% summarize(dem02 <- sum(WSADEM02), dem04 <- sum(WSADEM04), dem06 <- sum(WSADEM06), dem08 <- sum(WSADEM08), dem10 <- sum(WSADEM10), rep02 <- sum(WSAREP02), rep04 <- sum(WSAREP04), rep06 <- sum(WSAREP06), rep08 <- sum(WSAREP08), rep10 <- sum(WSAREP10), voting.age <- sum(PERSONS18), n())
nz <- rowSums(a0210[,2:6] != 0)
avg.dem <- rowSums(a0210[,2:6])/nz
nz <- rowSums(a0210[,7:11] != 0)
avg.rep <- rowSums(a0210[,7:11])/nz
xavg.dem <- is.na(avg.dem) 
xavg.rep <- is.na(avg.rep)
names(a0210) <- c("ASM","dem02","dem04","dem06","dem08","dem10","rep02","rep04","rep06","rep08","rep10","voting.age","n")
```

```{r Efficiency Gap, echo=FALSE}

eg.full <- function(dem,rep) {
  # Determine wasted votes
  dwin <- dem > rep
  rwasted <- sum(rep[dwin])+sum(rep[!dwin]-((dem[!dwin]+rep[!dwin])/2+1))
  dwasted <- sum(dem[!dwin])+sum(dem[dwin]-((dem[dwin]+rep[dwin])/2+1))
  eg.wasted <- sum(rwasted-dwasted)/sum(rep+dem)
  eg.wasted
}

eg.simple <- function(dem,rep) {
  # simple assumes only two parties
  # Efficiency Gap = Seat Margin – (2 x Vote Margin)
  #
  dem.seats <- sum(dem > rep)
  dem.share <- sum(dem)/sum(dem+rep)
  eg.dem <- ((dem.seats/length(dem))*100-50) - 2*(dem.share*100-50)
  rep.seats <- sum(rep > dem)
  rep.share <- sum(rep)/sum(dem+rep)
  eg.rep <- ((rep.seats/length(rep))*100-50) - 2*(rep.share*100-50)
  eg <- data.frame(cbind(c(dem.seats,rep.seats),c(dem.share,rep.share),c(eg.dem,eg.rep)))
  names(eg) <- c("Seats","Vote Share","Efficiency Gap")
  row.names(eg) <- c("Dem","Rep")
  eg
}

# Imputing Uncontested
impute <- function(a) {
  avg.turnout <- (a$dem+a$dem2+a$rep+a$rep2)/a$voting.age
  for (i in 1:nrow(a)) {
    if (a$dem[i] == 0) {      # Uncontested w/ no dem
      if (xavg.dem[i]) {      # If no average from prior elections
        a$rep[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.75)  # use avg turnout %
        a$dem[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.25)
      }
      else {
        if (avg.rep[i] > avg.dem[i]) {  # Make sure it's a rep win
          a$rep[i] <- avg.rep[i]      # and use actual prior avg's
          a$dem[i] <- avg.dem[i]      # 02-10
        }
        else {           # Don't think shoud happen but use % again
          a$rep[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.75)
          a$dem[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.25)
        }
      }
    }
    else if (a$rep[i] == 0) {  # Uncontested w/ no rep
      if (xavg.rep[i]) {         # If no rep avg from 02-10    
        a$dem[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.75)   # use avg turnout %
        a$rep[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.25)
      }
      else {
        if (avg.dem[i] > avg.rep[i]) {  # Make sure it's a dem win
          a$dem[i] <- avg.dem[i]      # and use actual prior avg's
          a$rep[i] <- avg.rep[i]      # 02-10
        }
        else {            # Don't think should happen but use % again
          a$dem[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.75) # use avg turnout %
          a$rep[i] <- as.integer(avg.turnout[i]*a$voting.age[i]*.25)  
        }
      }
    }
  }  
  a
}
```

Considering the original Efficiency Gap paper "Partisan Gerrymandering and the Efficiency Gap", referenced below. 

Two methods are indicated for computing the Efficiency Gap. One is based on totaling up all wasted votes, the other is based on seat and vote share margins. The second is algebraically derived from the first under certain assumptions.  

> <chunk style="font-size:15px">Instead, if we assume that all districts are <mark>equal in population</mark> (which is constitutionally required), and that there are <mark>only two parties</mark> (which is typical in SMD systems)</chunk>

Where <mark>SMD is single member district</mark>, meaning that each district has a single representative. The later is indicated as a possibly easier way to compute the EG (efficiency gap) without having to total up all the wasted votes. With R and the Wisconsin data provided (see Data in references - very complete), neither way really seems that much easier. 

I will follow the convention from "THE MEASURE OF A METRIC: THE DEBATE OVER QUANTIFYING PARTISAN GERRYMANDERING" of referring to them as the <mark>full</mark> efficiency gap or <mark>simple</mark> efficiency gap calculations.

Here are my Efficiency Gap calculations for the Wisconsin State Assembly elections for 2012 and 2014.

### 2012

```{r 2012 testing, echo=FALSE}
# should be party average from 02-10 * avg.turnout (if party avg)
#           loser getting avg.turnout - that
# if no party avg loser gets 25% avg.turnout, winner the rest
#
a12 <- w11 %>% group_by(ASM) %>% summarize(dem <- sum(WSADEM12), dem2 <- sum(WSADEM212), rep <- sum(WSAREP12), rep2 <- sum(WSAREP212), voting.age <- sum(PERSONS18),n())
names(a12) <- c("asm","dem","dem2","rep","rep2","voting.age","n")
a12 <- impute(a12)
cat("Wisconsin 2012 State Assembly 'simple' Efficiency Gap calculation\n")
eg.margins <- eg.simple(a12$dem,a12$rep)
eg.margins
cat("Wisconsin 2012 State Assembly 'full' Efficiency Gap calculation\n")
eg.wasted <- eg.full(a12$dem,a12$rep)*100
eg.wasted
```

### 2014

```{r 2014 testing, echo=FALSE}
a14 <- w11 %>% group_by(ASM) %>% summarize(dem <- sum(WSADEM14), rep <- sum(WSAREP14), rep2 <- sum(WSAREP214), voting.age <- sum(PERSONS18),n())
names(a14) <- c("asm","dem","rep","rep2","voting.age","n")
# The dataset flips the results for district 60
# I was getting incorrect seat counts. This fixes that.
temp60 <- a14[a14$asm==60,"rep"]
a14[a14$asm==60,"rep"] <- a14[a14$asm==60,"dem"]
a14[a14$asm==60,"dem"] <- temp60
a14$dem2 <- rep(0,nrow(a14))
a14 <- impute(a14)
cat("Wisconsin 2014 State Assembly 'simple' Efficiency Gap calculation\n")
eg <- eg.simple(a14$dem,a14$rep)
eg
cat("Wisconsin 2014 State Assembly 'full' Efficiency Gap calculation\n")
eg.wasted <- eg.full(a14$dem,a14$rep)*100
eg.wasted
```

I believe the Washington Post article "Here’s how the Supreme Court could
decide whether your vote will count" (see below) mixes up the Efficiency Gap calculations for 2012 and 2014. That indicated that the numbers for these years were provided by Simon Jackman. He appears to have done these calculations for the Wisconsin gerrymandering court case. 

From "Assessing the Current Wisconsin State Legislative Districting Plan" - link below.

> <chunk style="font-size:15px">8. The current Wisconsin state legislative districting plan (the “Current Wisconsin Plan”). In Wisconsin in 2012, the average Democratic share of district level, two-party vote (V) is estimated to be 51.4% (±0.6, the uncertainty stemming from imputations for uncontested seats); recall that Obama won 53.5% of the two-party presidential vote in Wisconsin in 2012. Yet Democrats won only 39 seats in the 99 seat legislature (S = 39.4%), making Wisconsin one of 7 states in 2012 where we estimate V > 50% but S < 50%. In Wisconsin in 2014, V is estimated to be 48.0% (±0.8) and Democrats won 36 of 99 seats (S = 36.4%).</chunk>

> <chunk style="font-size:15px">9. Accordingly, <mark>Wisconsin’s EG measures in 2012 and 2014 are large and negative: -.13 and -.10</mark> (to two digits of precision). The 2012 estimate is the largest EG estimate in Wisconsin over the 42 year period spanned by this analysis (1972-2014).</chunk>

Obama's results are mentioned because this assessment uses the "uniform swing", based on the presidential election, imputation method for missing (uncontested) districts. I attempted imputation based on past results from 2002-2010. Having the data and R to do the calculations, basing the imputation on actual past elections for the same sort of election seemed better. Although, I have seen other mention of presidential election "uniform swing" based imputation. 

So, we see that Jackman's numbers for these years are the reverse of what the Washington Post article indicates. Maybe not a big difference unless you want to compare your own calculations to what is shown. For 2012 Jackman actually got the -.13, where I get -14.01853. The difference is probably due to vote shares. For 2012 Jackman gives "51.4% (±0.6, the uncertainty stemming from imputations for uncontested seats);" whereas, as shown above, I get 0.5170623 for 2012 using a different imputation determination. The same for 2014 where our results are similar but not exact matches.

This also means that Jackman used the 'simple' caluclation method. I also did the 'full' vote calculation getting -19.37371. A very different, and worse, result. 

I thought that the assumptions made by the 'simple' method not actually applying here might be the reason it gives less accurate results. One thing that I thought might be a problem is the "equal population" assumption when given varying voter turnout. 

First I came up with some simple tests to verify the correctness of my 'full' calculation of EG.

```{r full tests, echo=FALSE}
# Based on [How the Efficiency Gap Works](https://www.brennancenter.org/sites/default/files/legal-work/How_the_Efficiency_Gap_Standard_Works.pdf)
testEG <- function() {
  cat("-- Equal Populations --\n")
  dem <- c(75,60,43,48,49)
  rep <- c(25,40,57,52,51)
  eg.test.wasted <- eg.full(dem,rep)
  cat("full   data 1",eg.test.wasted,"\n")
  eg.test.shares <- eg.simple(dem,rep)[1,"Efficiency Gap"]
  cat("simple data 1",eg.test.shares,"\n")
  dem <- c(53,53,53,53,15)
  rep <- c(47,47,47,47,85)
  eg.test.wasted <- eg.full(dem,rep)
  cat("full   data 2",eg.test.wasted,"\n")
  eg.test.shares <- eg.simple(dem,rep)[1,"Efficiency Gap"]
  cat("simple data 2",eg.test.shares,"\n")
}
testEG()
```

With equal populations the 'simple' and 'full' EG calcuations give essentially the same results. So my 'full' calculations should be more or less correct.

Now it can be tested to see the results stay the same if the voter turnout is varied...

```{r turnout test, echo=FALSE}
vary.turnout <- function() {
  #
  # Vary voter turnout
  #
  cat("-- Vary voter turnout --\n")
  dem <- c(75,60,43,48,49)
  rep <- c(25,40,57,52,51)
  turnout.scale <- c(1,.9,.8,.7,.6)
  dem <- dem*turnout.scale
  rep <- rep*turnout.scale
  eg.test.wasted <- eg.full(dem,rep)
  cat("full   data 3",eg.test.wasted,"\n")
  eg.test.shares <- eg.simple(dem,rep)[1,"Efficiency Gap"]
  cat("simple data 3",eg.test.shares,"\n")
}
eg.test <- vary.turnout()
```
Turnouts for both parties are proportionately varied to be respectively 100%, 90%, 80%, 70% or 60% of their initial values. You can see that this results in the final numbers being significantly different.

Some of the issues that have been raised against the Efficiency Gap are addressed in "THE MEASURE OF A METRIC: THE DEBATE OVER QUANTIFYING PARTISAN GERRYMANDERING". In that we find...

> <chunk style="font-size:15px"> If turnout is assumed to be equal, the “simplified form” of the efficiency gap can be used: (S – 0.5) – 2 × (V – 0.5), where S is a party’s statewide seat share and V is the party’s vote share averaged across all districts. <mark>To take into account district-level variations in </mark><mark style="background-color:red;">turnout</mark>, <mark>the “full form” of the efficiency gap <mark style="background-color:red;">must</mark> be used instead</mark>.</chunk>

So, there is agreement from the gap creators. The full calculation <mark style="background-color:red;">must</mark> be used with voter turnout. The assessment that Simon Jackman did for the Wisconsin court case had great scope across many states and years. Using the 'simple' calculation must of seemed to be a considerable convenience. But I think it was a mistake. For any serious consideration of Efficiency Gap in real elections where there is considerable variance in voter turnout the 'simple' calculation should never be used.

## Reference

### Data

[Wisconsin Data Libarary](http://legis.wisconsin.gov/ltsb/gis/data/)

### Gerrymandering Introduction

[EVERYTHING YOU ALWAYS WANTED TO KNOW ABOUT REDISTRICTING](https://www.aclu.org/files/assets/2010_REDISTRICTING_GUIDE_web_0.pdf)

[Gerrymandering](https://quizlet.com/245844307/gerrymandering-flash-cards/)
Take a quiz.

### Efficiency Gap

[Partisan Gerrymandering and the Efficiency Gap](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2457468)
The original paper

[The Most Gerrymandered States Ranked by Efficiency Gap and Seat Advantage](https://www.azavea.com/blog/2017/07/19/gerrymandered-states-ranked-efficiency-gap-seat-advantage/)

### Equal Population Requirement

[Where are the lines drawn?](http://redistricting.lls.edu/where.php)

### Uncontested Counties Imputation

[Partisan Gerrymandering and the Efficiency Gap](https://chicagounbound.uchicago.edu/cgi/viewcontent.cgi?referer=https://www.google.com/&httpsredir=1&article=1946&context=public_law_and_legal_theory)  
Discussion of uncontested and imputation beginning on P. 27.


[2016 Election Results Prove
Gerrymandering](https://urbanmilwaukee.com/2016/12/28/data-wonk-2016-election-results-prove-gerrymandering/)  
Discussion of imputation in the comments.

[Here’s how the Supreme Court could
decide whether your vote will count](https://www.washingtonpost.com/graphics/2017/politics/courts-law/gerrymander/?utm_term=.b3c0a0b9d31d)  
The state map graphics show how frequent uncontested State Assembly elections are in Wisconsin. It seems a major concern when values for almost half of the elections need to be imputed. 

### Gerrymandering Court Cases and Efficiency Gap

[Current Partisan Gerrymandering Cases](https://www.brennancenter.org/analysis/ongoing-partisan-gerrymandering-cases)

[Pennsylvania's Supreme Court just gave Democrats a big win on redistricting](https://www.washingtonpost.com/news/the-fix/wp/2018/01/22/pennsylvanias-supreme-court-just-gave-democrats-a-big-win-on-redistricting/?utm_term=.48744907c4e7)

[The research that convinced SCOTUS to take the Wisconsin gerrymandering case, explained](https://www.vox.com/the-big-idea/2017/7/11/15949750/research-gerrymandering-wisconsin-supreme-court-partisanship)

[Assessing the Current Wisconsin State Legislative Districting Plan](http://www.campaignlegalcenter.org/sites/default/files/WI%20whitford%2020150708%20complaint%20exh3.pdf)

### Efficiency Gap Cautions

[The Flaw in America's 'Holy Grail' Against Gerrymandering](https://www.theatlantic.com/science/archive/2018/01/efficiency-gap-gerrymandering/551492/)

[THE MEASURE OF A METRIC:
THE DEBATE OVER QUANTIFYING PARTISAN GERRYMANDERING](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3077766)